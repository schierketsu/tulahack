!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["@yandex/ymaps3-clusterer"]=t():e["@yandex/ymaps3-clusterer"]=t()}(self,(()=>(()=>{"use strict";var e={569:(e,t,r)=>{var i,o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.YMapClusterer=void 0;const n=r(508),a=r(272),u=r(146),l=r(397),c=Object.freeze({tickTimeout:n.THROTTLE_DEFAULT_TIMEOUT_MS});class d extends ymaps3.YMapComplexEntity{constructor(e){super(e),this._entitiesCache={},this._visibleEntities={},this._render=this._render.bind(this)}_isVisible(e,t,r){const{x:i,y:o}=r.toWorldCoordinates(e.geometry.coordinates),{x:s,y:n}=r.toWorldCoordinates(t[0]),{x:a,y:u}=r.toWorldCoordinates(t[1]),l=a-s,c=n-u;return s-l/2<=i&&a+l/2>=i&&n+c/2>=o&&u-c/2<=o}_getEntity({lnglat:e,features:t,clusterId:r}){let i=this._entitiesCache[r];return i||(i=1===t.length?this._props.marker(t[0]):this._props.cluster(e,t),this._entitiesCache[r]=i),i}_getVisibleEntities(e){const t={};return e.forEach((e=>{const r=this._getEntity(e);t[e.clusterId]=r})),t}_syncVisibleEntities(e){for(const t in this._visibleEntities)e[t]||this._container.removeChild(this._visibleEntities[t]);for(const t in e)this._visibleEntities[t]||this._container.addChild(e[t])}_render({mapInAction:e}={}){const t=this.root;if(!t||e)return;const r=this._props.features.filter((e=>this._isVisible(e,t.bounds,t.projection)));let i;if(i=this._props.maxZoom&&t.zoom>this._props.maxZoom?r.map((e=>({world:t.projection.toWorldCoordinates(e.geometry.coordinates),lnglat:e.geometry.coordinates,clusterId:e.id,features:[e]}))):this._props.method.render({map:t,features:r}),this._props.onRender&&!1===this._props.onRender(i))return;const o=this._getVisibleEntities(i);this._syncVisibleEntities(o),this._visibleEntities=o}_onAttach(){this._entitiesCache={},this._visibleEntities={},this._container=new ymaps3.YMapCollection({}),this.addChild(this._container);const e=this._props.tickTimeout?(0,a.throttle)(this._render,this._props.tickTimeout):this._render;this._mapListener=new ymaps3.YMapListener({onUpdate:e,onResize:e}),this.addChild(this._mapListener),this._render()}_onDetach(){this.removeChild(this._container),this.removeChild(this._mapListener),this._entitiesCache={},this._visibleEntities={}}_onUpdate(){this._render()}}t.YMapClusterer=d,i=ymaps3.overrideKeyReactify,o=ymaps3.overrideKeyVuefy,s=ymaps3.optionsKeyVuefy,d.__implName="YMapClusterer",d.defaultProps=c,d[i]=u.YMapClustererReactifyOverride,d[o]=l.YMapClustererVuefyOverride,d[s]=l.YMapClustererVuefyOptions},508:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.THROTTLE_DEFAULT_TIMEOUT_MS=void 0,t.THROTTLE_DEFAULT_TIMEOUT_MS=200},272:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=void 0,t.throttle=(e,t)=>{let r,i,o;return function(){const s=this,n=arguments;r?(clearTimeout(i),i=setTimeout((()=>{Date.now()-o>=t&&(e.apply(s,n),o=Date.now())}),Math.max(t-(Date.now()-o),0))):(e.apply(s,n),o=Date.now(),r=!0)}}},482:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertPixelSizeToWorldSize=t.divn=void 0,t.divn=function(e,t,r={x:0,y:0}){return r.x=e.x/t,r.y=e.y/t,r},t.convertPixelSizeToWorldSize=function(e,t,r){const i=2**t/2*256;return function(e,t,r={x:0,y:0}){return r.x=e.x/t.x,r.y=e.y/t.y,r}(e,{x:i,y:-i},r)}},500:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(599),t),o(r(569),t),o(r(713),t)},599:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},786:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clusterByGrid=void 0;const i=r(482);class o{constructor(e){this._nextFeatureIndex=0,this._featureIdCharCache={},this._gridSize=e}_getClusterSizeWorld(e){return(0,i.convertPixelSizeToWorldSize)({x:this._gridSize,y:0},e).x}_computeVisibleClusters(e,t,r){const o=(0,i.divn)((0,i.convertPixelSizeToWorldSize)(e,t),2),s=r.y+o.y,n=r.y-o.y,a=r.x-o.x,u=r.x+o.x,l=this._getClusterSizeWorld(t),c=Math.floor(a/l),d=Math.ceil(u/l),p=Math.floor(s/l),h=Math.ceil(n/l),f=new Map;for(let e=c;e<=d;e++)for(let t=p;t<=h;t++)f.set(`${e}-${t}`,!0);return f}_clusterize(e,t,r){const i=new Map,o=this._getClusterSizeWorld(r);for(const r of t){const t={world:e.projection.toWorldCoordinates(r.geometry.coordinates),lnglat:r.geometry.coordinates,clusterId:"",features:[r]},s=`${Math.floor(t.world.x/o)}-${Math.floor(t.world.y/o)}`;let n=i.get(s);n||(n={sumX:0,sumY:0,objects:[],features:[]},i.set(s,n)),n.sumX+=t.world.x,n.sumY+=t.world.y,n.objects.push(t),n.features.push(t.features[0])}return i}_generateClusterId(e){const t=["cluster-"];return e.forEach((({id:e})=>{this._featureIdCharCache[e]||(this._featureIdCharCache[e]=String.fromCharCode(this._nextFeatureIndex),this._nextFeatureIndex+=1),t.push(this._featureIdCharCache[e])})),t.join("")}render({map:e,features:t}){const r=Math.round(e.zoom),i=this._computeVisibleClusters(e.size,r,e.projection.toWorldCoordinates(e.center)),o=this._clusterize(e,t,r),s=[];for(const[t,r]of o.entries()){if(!i.get(t))continue;const o=r.objects.length;if(1===o)s.push({...r.objects[0],clusterId:r.features[0].id});else{const t={x:r.sumX/o,y:r.sumY/o};s.push({world:t,lnglat:e.projection.fromWorldCoordinates(t),clusterId:this._generateClusterId(r.features),features:r.features})}}return s}}t.clusterByGrid=function({gridSize:e}){return new o(e)}},713:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clusterByGrid=void 0;var i=r(786);Object.defineProperty(t,"clusterByGrid",{enumerable:!0,get:function(){return i.clusterByGrid}})},146:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.YMapClustererReactifyOverride=void 0,t.YMapClustererReactifyOverride=(e,{reactify:t,React:r})=>{const i=t.entity(e);return r.forwardRef(((e,t)=>{const[o,s]=r.useState([]),n=r.useCallback((t=>{const i={};return t.forEach((({lnglat:t,features:o,clusterId:s})=>{i[s]=r.createElement(r.Fragment,{key:s},1===o.length?e.marker(o[0]):e.cluster(t,o))})),s(Object.values(i)),!1}),[e]);return r.createElement(r.Fragment,null,r.createElement(i,{...e,ref:t,onRender:n}),o)}))}},397:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.YMapClustererVuefyOverride=t.YMapClustererVuefyOptions=void 0;const i=r(508);t.YMapClustererVuefyOptions={props:{method:{type:Object,required:!0},features:{type:Array,required:!0},marker:Function,cluster:Function,tickTimeout:{type:Number,default:i.THROTTLE_DEFAULT_TIMEOUT_MS},onRender:Function,maxZoom:{type:Number}}},t.YMapClustererVuefyOverride=(e,t,{vuefy:r,Vue:i})=>{const o=r.entity(e,t),s=r.entity(ymaps3.YMapCollection);return i.defineComponent({name:"YMapClustererContainer",props:t,slots:Object,setup(e,{slots:t}){const r=i.ref(null),n=e=>{const o={};return e.forEach((({lnglat:e,features:r,clusterId:s})=>{var n,a;o[s]=i.h(i.Fragment,{key:s},1===r.length?null===(n=t.marker)||void 0===n?void 0:n.call(t,{feature:r[0]}):null===(a=t.cluster)||void 0===a?void 0:a.call(t,{coordinates:e,features:r}))})),r.value=Object.values(o),!1};return()=>[i.h(o,{...e,onRender:n}),i.h(s,(()=>r.value))]}})}},341:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,o)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(500),t),o(r(683),t)},683:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})}},t={};return function r(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,r),s.exports}(341)})()));